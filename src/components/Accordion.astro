---
import { Icon } from 'astro-icon/components';

interface Props {
  text: string;
  link?: string;
}

const { text, link } = Astro.props;
---

<div class="group bg-light border border-light hover:border-blue rounded-lg transition" data-accordion>

  <button class:list={ [link ? "hidden" : "flex", "w-full items-center text-left font-medium p-7"] } type="button" title={ text }>
    { text }
    <span class="flex ml-auto">
      <Icon class="opacity-0 w-3 h-3 minus" name="minus" />
      <Icon class="opacity-100 w-3 h-3 plus" name="plus" />
    </span>
  </button>
  {
    link && (
      <a class="flex items-center p-7 w-full font-medium text-left" href={link}>
        { text }
        <span class="flex ml-auto">
          <Icon class="w-3.5 h-3.5 text-blue" name="arrow-right" />
        </span>
      </a>
    )
  }
  <div class="max-h-0 group-[.is-expanded]:max-h-[100vmax] overflow-hidden transition-all duration-500">
    <div class="px-7 py-9 border-gray border-t">
      <slot />
    </div>
  </div>
</div>

<script>
  const accordionTabs = document.querySelectorAll("[data-accordion] button");
  [...accordionTabs].forEach((el) => {
    el.addEventListener("click", (ev: Event): void => {
      const btn = ev.currentTarget as HTMLButtonElement;     
      const tabEl = btn.parentNode as HTMLElement;
      tabEl.classList.toggle('is-expanded');
    });
  });
</script>

<style lang="scss" is:global>
  [data-accordion] {    
    &.is-expanded {
      .minus {
        order: 1;
        opacity: 1;
      }
      .plus {
        order: 0;
        opacity: 0;
      }
    }
  }
</style>
